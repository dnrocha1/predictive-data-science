---
title: "Predição de Votação de Deputados"
author: "Daniyel Rocha"
date: "09 de novembro de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
library(dplyr)
library(caret)
```

```{r}
train <- read.csv("data/lab02/train.csv")
test <- read.csv("data/lab02/test.csv")
```

```{r}
#ano!, uf!, cargo!, estado_civil, sequencial_candidato!, partido, sexo, ocupacao!, nome!, grau
#grau, partido?, estado_civil??, sexo???
input <- train %>% 
  select(-cargo, -nome, -ocupacao, -ano, -sequencial_candidato, -uf, -sexo, -estado_civil)
```

## Questão 1
  + Usando todas as variáveis disponíveis, tune (usando validação cruzada): (i) um modelo de regressão Ridge, (ii) um modelo de regressão Lasso e (iii) um modelo KNN. Para os modelos de regressão linear, o parâmetro a ser tunado é o lambda (penalização dos coeficientes) e o KNN o número de vizinhos. (9 pts.)
  
```{r}

ctrl <- trainControl(
  method = "repeatedcv",
  number = 10,
  repeats = 10,
  verboseIter = TRUE
  )

lambda.range <- expand.grid(lambda = seq(10^-10, 10^-2, length=30))

model.ridge <- caret::train(
  votos ~.,
  data = input, 
  method = "ridge",
  metric = "RMSE",
  trControl = ctrl,
  tuneGrid = lambda.range,
  preProcess = c('scale', 'center')
)

model.ridge
plot(model.ridge, xlab = "Lambda", ylab = "RMSE")

model.ridge %>% 
  varImp() %>% 
  ggplot()

predictors(model.ridge)
```


```{r}
# ctrl <- trainControl(
#   method = "repeatedcv",
#   number = 70,
#   repeats = 10,
#   verboseIter = TRUE
#   )

lambda.range <- expand.grid(fraction = seq(10^-2, 10^-8, length=20))
# lambda.range <- expand.grid(fraction = seq(0.01, 10^-8, length=20))

model.lasso <- caret::train(
  votos ~.,
  data = input, 
  method = "lasso",
  metric = "RMSE",
  trControl = ctrl,
  tuneGrid = lambda.range,
  preProcess = c('scale', 'center')
)

model.lasso
plot(model.lasso, xlab = "Lambda", ylab = "RMSE")

model.lasso %>% 
  varImp() %>% 
  ggplot()

predictors(model.lasso)
```


```{r}
# ctrl <- trainControl(
#   method = "repeatedcv",
#   number = 40,
#   repeats = 1,
#   verboseIter = TRUE
#   )

knn.range <- expand.grid(k = seq(1, 100, length=100))

model.knn <- caret::train(
  votos ~.,
  data = input, 
  method = "knn",
  metric = "RMSE",
  trControl = ctrl,
  tuneGrid = knn.range,
  preProcess = c('scale', 'center')
)

model.knn
plot(model.knn)

model.knn %>% 
  varImp() %>% 
  ggplot()

predictors(model.knn)
```


## Questão 2
  + Compare os três modelos em termos do erro RMSE de validação cruzada. (9 pts.)
```{r}
results <- resamples(list(knn=model.knn, ridge=model.ridge, lasso=model.lasso))

results %>% summary("RMSE")


```


```{r}

input <- train %>%
  select(-cargo, -nome, -ocupacao, -ano, -sequencial_candidato, -uf)

# ctrl <- trainControl(
#   method = "repeatedcv",
#   number = 5,
#   repeats = 5,
#   verboseIter = TRUE
#   )

ctrl <- trainControl(
  method = "cv",
  number = 5,
  repeats = 5,
  verboseIter = TRUE
  )

model.ridge
plot(model.ridge, xlab = "Lambda", ylab = "RMSE")

model.lasso <- caret::train(
  votos ~.,
  data = input,
  method = "lasso",
  metric = "RMSE",
  trControl = ctrl,
  tuneGrid = lambda.range,
  tuneLength = 20,
  preProcess = c('scale', 'center')
)

model.lasso
plot(model.lasso, xlab = "Lambda", ylab = "RMSE")

knn.range <- expand.grid(k = seq(1, 50))

model.knn <- caret::train(
  votos ~.,
  data = input,
  method = "knn",
  metric = "RMSE",
  trControl = ctrl,
  tuneGrid = knn.range,
  preProcess = c('scale', 'center')
)

model.knn
plot(model.knn, xlab = "Lambda", ylab = "RMSE")
```

## FAZER ELASTIC NET

```{r}

```

